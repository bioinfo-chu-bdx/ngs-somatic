LocatIt
=======
LocatIt processes the Molecular Barcode (MBC) information of a HaloPlex<sup>HS</sup>, SureSelect XT HS, or SureSelect XT HS2 Illumina sequencing run. For HaloPlex<sup>HS</sup> and SureSelect XT HS analyses, LocatIt will tag read pairs in a SAM/BAM file with their MBC sequences and mark or merge MBC duplicates from that SAM/BAM file. For SureSelect XT HS2 analyses, LocatIt requires that the input bam file has already been annotated with the MBC sequences (using Trimmer and BWA-MEM with "-C" parameter, for example).
<br>

*Note: This jar was compiled using Java version 8. Please make sure your Java Runtime Environment is at least at version 8 by running the command “java –version”.*
<br>

### Command-line syntax

* For SureSelect XT HS2  (assumes that the input file already has the correct MBC tags):
```
java -Xmx12G -jar locatit.jar [OPTIONS] input_bam_file_name
```

* For other applications:
```
java -Xmx12G -jar locatit.jar [OPTIONS] input_bam_file_name index2_fastq_file_1 index2_fastq_file_2
```
***Note: -Xmx12G is just an example, please adjust memory based on sequencing depth and size of the input file.*** 
<br>

### Required parameters:
-----
| Parameter | Description |
| ----- | -----|
| `input_bam_file_name` | name of the input BAM or SAM file. |
| `index2_fastq_file_1..N` | input fastq file(s) containing the MBC sequences for the read pairs in the input bam file (not applicable to SureSelect XT HS2 analyses). The fastq files must contain all reads that are in the S/BAM file, but may also contain reads that have been filtered out of the S/BAM during processing. |
------
<br>

###  Options:
-----
| Option | Description |
| ------ | ----------- |
| `-l <covered.bed>` | Specify covered bed file downloaded from Agilent's SureDesign. If specified, the properties file histogram reflects what is happening within and not within the covered region. For SureSelect designs, this option is identical to the -b covered.bed option described above. |
| `‐b <intervals.bed>` | Provide design files downloaded from Agilent's SureDesign website. For Haloplex designs, use the amplicon bed file. For SureSelect designs, this option is identical to the -l. |
| `-o <output_file_name>` | name of the file generated by LocatIt. |
| `-v2Only` | For SureSelect XT HS2, turn on the duplex consensus mode option. The input SAM/BAM file needs to already be annotated with the correct 3+3 MBC SAM tags. First, LocatIt performs single-strand consensus deduplication. When two complementary single-strand consensus sequences are present, they are used to generate a duplex consensus sequence. All single-strand consensus reads are marked as not passing the vendor quality test and should be filtered out prior to running any downstream analysis. |
| `-i` | Incremental; instead of having the list of amplicons, i.e. the list of all possible pair starts/stops, the program learns all the possible start/stop combinations as it is reading the data. This is the main option that switches between HaloPlex and SureSelect modes. LocatIt performs single-strand consensus deduplication for both SureSelect XT HS and XT HS2. |
| `-v2` | **Experimental, do not use.** For SureSelect XT HS2, turns on the "hybrid" deduplication approach. The approach is the same as for -v2Only mode, but the single-strand consensus reads are not flagged as failing the vendor quality test. The resulting BAM file may cause downstream applications to under-value the duplicate consensus reads compared to the single-consensus reads. |
| `-R` | Output bam file that has duplicates(SAM flag 0x400), filtered reads(SAM flag 0x200), secondary(SAM flag 0x100) and supplementary(SAM flag 0x800) reads removed. |
| `-d <number>` | Barcode distance. If two populations of read (pairs) only differ by this number of bases, both populations will be processed as having the same barcode. Because several errors can be merged back into the main population, some barcodes that are more than this number of bases away from each other may end up being merged together. <br>Range is 0 to 5. Default value is 0. |
| `-q <number>` | Reads having barcodes with quality less than specified threshold will be filtered. <br>Range is 0 to 45. Default value is 25. |
| `-Q <number>` | Reads having any base that is lower than specified threshold will be filtered. <br>Range is 0 to 45. Default value is 0. |
| `-m <number>` | Parameter specifies minimum number of read pairs associated with a barcode (amplification level). Barcodes having less reads than specified threshold will be filtered. <br>Range is >=1. Default value is 1. |
| `-c <number>` | Enable optical duplicate detection and offset between two duplicate clusters on the flow cell in order to consider them optical duplicates. The offset is specified as a radius in pixels. If the offset between two duplicate clusters is less than this threshold, then the clusters are considered to be optical duplicates. <br> The value expected is an integer >= 0. For unpatterned Illumina flow cells, 100 is an appropriate value. For the patterned flow cells, 2500 is more appropriate. By default, optical duplicate detection is disabled. |
| `‐U` | unsorted BAM/SAM output ‐ Faster and requires less RAM. |
| `‐S` | sorted BAM/SAM output |
| `-L` | If the input SAM/BAM contains fewer reads than the index2 file(s) and they are in the same order, the option -L allows LocatIt to discard non-matching index2 reads as it processes the input file instead of buffering them in case the matching reads would show up later. This saves a lot of memory. |
| `-C` | Chimeric; For HaloPlex, this means that the pairs which match two different amplicons are kept. For SureSelect, it should be always on. If -i is specified it sets -C internally. |
| `-r`  | To remove/mask read1 read2 common overlap, half on each side. |
| `‐IB` | input file is BAM (default is SAM) |
| `-IS` | input file is SAM (default is SAM) |
| `‐OB` | output file is BAM (default is BAM) |
| `-OS` | output file is SAM (default is BAM) |
| `-P` | Renames the SAM tags so that downstream pipelines expecting different conventions can be used.<br>*Syntax:* -P[letter]:[new 2 letters tag],[next],...<br>*Example:* `-PM:xm,Q:xq,q:nq,r:nr` <br>The tags that can be renamed are:<ul><li>`M` for barcode sequence</li><li>`Q` for barcode quality</li><li>`q` for barcode consensus quality</li><li>`r` for read consensus quality</li><li>`N` for barcode name tag</li><li>`a` for alt readnames tag</li><li>`d` for readnames tag</li><li>`1` for begin amplicon tag</li><li>`2` for end amplicon tag</li> |
| `-K` | Keep the intermediate bam file. With this option a coordinate-sorted and barcode-annotated bam file will be written to the parent directory of input bam file. By default this is not applied and is only useful for debugging. |
| `‐X <temp_directory>` | Location of temporary bam files used to store overflow of matches. Temporary files will be deleted at program exit. |
| `‐t <temp_directory>` | Location of temporary bam files used to store overflow of matches. Temporary files are not deleted. |
------
<br>

### Usage examples:
* For SureSelect XT HS2
```
java -Xmx12G -jar locatit.jar \
     -S -v2Only -d 1 -m 3 -q 25 -Q 25 \
     -l Covered.bed -o test_output.bam \ 
     test_input.bam
```
* For SureSelect XT HS (and XT HS2 without duplex consensus)
```
java -Xmx12G -jar locatit.jar \ 
     -PM:xm,Q:xq,q:nQ,r:nR \
     -q 25 -m 1 -U -IS -OB -C -i -r \ 
     -l covered.bed -o test_OUTPUT Test_CCP.sam \
     CCP_1_AACGTGAT_L001_R2_001.fastq.gz \
     CCP_1_AACGTGAT_L001_R2_002.fastq.gz
```
 * For Halo
```
java -Xmx12G -jar locatit.jar \
     -q 25 -m 1 -U -IS -OB \
     -b ISCA2bf_extraG_001001398178390_AllTracks_amplicons.bed \
     -o test_OUTPUT \
     Test_ICCG_Panel.sam \
     ICCG-repl1_S1_L001_I1_001.fastq.gz
```
<br>

#### Tags For SureSelect XT HS2:
LocatIt might insert some tags into SAM records and here are their meanings:
* fi:Z:*justifications for being filtered out/flagged as not passing vendor quality test*
e.g.&nbsp;`fi:Z:BAD_READ2_QUALITY;BELOW_MBC_NREADS_LIMIT;`
* XI:i:*number of duplicates collapsed for the single-strand consensus read*
e.g. `XI:i:2`
* XJ:i:*the number of duplicates collapsed for the single-strand consensus read on the complementary strand. (XT HS2 duplex consensus only.)*
e.g.  `XJ:i:1`

